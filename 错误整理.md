# 错误整理

标签（空格分隔）： 错误整理

---

 1. Json 格式转换的问题
------------
**问题**：关联表查询时，如果查询出来的结果集里有这样类型的字段：`["_related":"CActiveRecord":private] => 'xxxxx'`
在转换成 json 格式的时候，该类型的数据会丢失。

**原因**：该字段的类型是关联表里的私有属性，`CJSON::encode()` 方法并不能获取到这种类型的字段

**解决方法**：在主表的 Model 里定义一个共有属性，在转换成 json 格式之前，把这个关联表的字段赋值给该共有属性，然后再进行格式的转换就能转换成功啦

【关于这个问题已经踩过两次坑了_(┐「ε:)_，第二次踩坑是因为自己眼瞎，赋值的时候把属性名写错了还恬不知耻的敢再次怀疑这个`CJSON::encode()` 方法有问题。海燕呐！你可长点心吧！】

2. Model 层函数的问题
------------
Model 层里的函数尽量写成没有副作用的方法，可以降低方法的耦合度，比如说能传参数进来的，就尽量不要在方法里直接获取。

3. 接口获取参数的问题
---------
**问题**：获取的 `string` 类型的参数在需要注意大小写问题，还有字符串前后是否有空格的问题

**解决方法**：获取到这种类型的参数，例如邮箱账号，可以做转换成小写`strtolower()`，过滤掉账号前后的空格`trim()`处理

